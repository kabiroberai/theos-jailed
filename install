#!/bin/bash
set -e
cd "$(dirname "$0")"

function error { echo "Error: $1" >&2; exit 1; }

# Modify these to specify a custom install path
MODULE_PATH="$THEOS/mod/jailed/"
TEMPLATE_PATH="$THEOS/templates/ios/kabiroberai/"

[ -d "$THEOS" ] || error "\"$THEOS\" is not a directory. Aborting..."

# Install module
ln -s "$PWD/update" "module/bin/update"
mkdir -p "$MODULE_PATH"
rm -rf "$MODULE_PATH"/*
cp -a module/ "$MODULE_PATH"
rm "module/bin/update"
echo "Successfully installed module."

# Install template
"$THEOS/bin/nicify.pl" template 2> /dev/null || error "Failed to nicify template"
mkdir -p "$TEMPLATE_PATH"
mv *.nic.tar "$TEMPLATE_PATH/jailed.nic.tar"
echo "Successfully installed template."
